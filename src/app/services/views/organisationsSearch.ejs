<div class="govuk-width-container govuk-main-wrapper">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h1 class="govuk-heading-xl govuk-!-margin-top-0">
                Organisations
            </h1>
            <form method="post" id="form-organisation-search">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <fieldset class="govuk-fieldset">
                    <div class="govuk-form-group">
                        <label for="criteria" class="govuk-label govuk-label--s govuk-visually-hidden">
                            Search by name, urn, uid or ukprn
                        </label>
                        <input class="govuk-input govuk-!-width-three-quarters" type="text" id="criteria" name="criteria" value="<%= criteria %>" placeholder="Search by name, urn, uid or ukprn">
                        <button type="submit" class="govuk-button" data-module="govuk-button">
                            Search
                        </button>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
    
    <%
    const paginationModel = {
        currentPage: locals.page,
        numberOfPages: locals.numberOfPages,
        totalNumberOfResults: locals.totalNumberOfResults,
        numberOfResultsOnPage: locals.organisations.length,
        data: [
            { key: 'criteria', value: locals.criteria },
            { key: 'sort', value: locals.sortBy },
            { key: 'sortDir', value: locals.sortOrder }
        ]
    }
    %>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <%- include('../../layouts/pagination', paginationModel); %>
            <table class="govuk-table">
                <thead class="govuk-table__head">
                    <% let baseSortUri = `?page=${page}&criteria=${criteria}`; %>
                    <tr class="govuk-table__row sortable">
                        <th scope="col" class="govuk-table__header width-35">
                            <a
                            href="<%=baseSortUri%>&sort=name&sortDir=<%= sort.name.nextDirection %>"
                            class="govuk-link <% if (sort.name.applied) { %>sorted dir-<%= (sort.name.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            Name
                            </a>
                        <th scope="col" class="govuk-table__header width-15">
                            <a
                            href="<%=baseSortUri%>&sort=type&sortDir=<%= sort.type.nextDirection %>"
                            class="govuk-link <% if (sort.type.applied) { %>sorted dir-<%= (sort.type.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            Type
                            </a>
                        </th>
                        <th scope="col" class="govuk-table__header width-10">
                            <a
                            href="<%=baseSortUri%>&sort=urn&sortDir=<%= sort.urn.nextDirection %>"
                            class="govuk-link <% if (sort.urn.applied) { %>sorted dir-<%= (sort.urn.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            URN
                            </a>
                        </th>
                        <th scope="col" class="govuk-table__header width-10">
                            <a
                            href="<%=baseSortUri%>&sort=uid&sortDir=<%= sort.uid.nextDirection %>"
                            class="govuk-link <% if (sort.uid.applied) { %>sorted dir-<%= (sort.uid.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            UID
                            </a>
                        </th>
                        <th scope="col" class="govuk-table__header width-10">
                            UPIN
                        </th>
                        <th scope="col" class="govuk-table__header width-15">
                            <a
                            href="<%=baseSortUri%>&sort=ukprn&sortDir=<%= sort.ukprn.nextDirection %>"
                            class="govuk-link <% if (sort.ukprn.applied) { %>sorted dir-<%= (sort.ukprn.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            UKPRN
                            </a>
                        </th>
                        <th scope="col" class="govuk-table__header width-15 govuk-table__header--numeric">
                            <a
                            href="<%=baseSortUri%>&sort=status&sortDir=<%= sort.status.nextDirection %>"
                            class="govuk-link <% if (sort.status.applied) { %>sorted dir-<%= (sort.status.nextDirection === 'asc') ? 'd' : 'a' %> <% } %>">
                            Status
                            </a>                            
                        </th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    <% if(locals.organisations.length === 0 && locals.criteria) { %>
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell" colspan="7">
                            <div class="empty-state">
                                <p class="govuk-body">No organisations found</p>
                            </div>
                        </td>
                    </tr>
                <% } %>
                <% for (let i = 0; i < locals.organisations.length; i++) { %>
                    <tr class="govuk-table__row">
                        <th class="govuk-table__cell govuk-table__header govuk-!-padding-bottom-4 govuk-!-padding-top-4">
                            <a class="govuk-link" href="organisations/<%= organisations[i].id %>/users"><%= organisations[i].name %></a>
                        </th>
                        <td class="govuk-table__cell govuk-!-font-size-16"><%= organisations[i].category.name %></td>
                        <td class="govuk-table__cell govuk-!-font-size-16"><%= organisations[i].urn %></td>
                        <td class="govuk-table__cell govuk-!-font-size-16"><%= organisations[i].uid %></td>
                        <td class="govuk-table__cell govuk-!-font-size-16"><%= organisations[i].upin ? organisations[i].upin : '' %></td>
                        <td class="govuk-table__cell govuk-!-font-size-16"><%= organisations[i].ukprn %></td>
                        <td class="govuk-table__cell govuk-!-font-size-16 govuk-table__cell--numeric"><%= organisations[i].status!==undefined ? organisations[i].status.name : '' %></td>
                    </tr>
                <% } %>
                </tbody>
            </table>
            <%- include('../../layouts/pagination', paginationModel); %>
        </div>
    </div>
</div>
